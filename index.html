<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Počasí</title>
  <link rel="stylesheet" href="./index.css">
  <script src="./index.js" defer></script>
</head>
<body>
  <div class="container">
    
    <script src="https://cdn.auth0.com/js/auth0-spa-js/2.0/auth0-spa-js.production.js"></script>
    <script type="module">
      const Auth0_domain = "dev-cz1xfrqlz4gbz633.us.auth0.com"
      const Auth0_id = "GcpBuKna5egJWpvRWTEfbKFte1mywkA8"

      import createAuth0Client from 'https://cdn.auth0.com/js/auth0-spa-js/2.0/auth0-spa-js.production.js';

      let auth0 = null;

      const configureClient = async () => {
        auth0 = await createAuth0Client({
          domain: Auth0_domain,
          client_id: Auth0_id,
          redirect_uri: window.location.origin,
        });
      };

      const login = async () => {
        await auth0.loginWithRedirect({
          redirect_uri: window.location.origin,
        });
      };

      const logout = () => {
        auth0.logout({
          returnTo: window.location.origin,
        });
      };

      const isAuthenticated = async () => {
        return await auth0.isAuthenticated();
      };

      const getUser = async () => {
        const user = await auth0.getUser();
        console.log(user);
        return user;
      };

      const handleAuth = async () => {
        const isAuth = await isAuthenticated();
        if (isAuth) {
          const user = await getUser();
          document.getElementById('user').textContent = `Hello, ${user.name}`;
        }
      };

      window.onload = async () => {
        await configureClient();
        if (window.location.search.includes('code=') && window.location.search.includes('state=')) {
          await auth0.handleRedirectCallback();
          window.history.replaceState({}, document.title, '/');
        }
        await handleAuth();
      };

      document.getElementById('login').addEventListener('click', login);
      document.getElementById('logout').addEventListener('click', logout);
    </script>
    <button id="login">Login</button>
    <button id="logout">Logout</button>
    <div id="user"></div>

    <h1>Počasí</h1>
    <label for="location">Lokace:</label>
    <input type="text" id="location" name="location"><br><br>
    <button type="button" onclick="writeText()">Najdi</button>
    <div id="output1"></div>
    <div id="output2"></div>
    <div id="imgContainer"></div>
  </div>
</body>
<footer>
<p>
  powered by OpenWeather 
</p>
</footer>
</html>